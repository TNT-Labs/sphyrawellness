From: Claude Code Audit <audit@sphyrawellness.local>
Date: Wed, 11 Dec 2025 13:00:00 +0000
Subject: [PATCH] fix(security): Remove insecure JWT_SECRET fallback [ISSUE-001]

The authentication middleware uses a hardcoded default JWT_SECRET when
the environment variable is not set. This is a critical security risk
in production as it allows attackers to generate valid JWT tokens.

This patch:
- Removes the insecure fallback value
- Adds validation to fail fast if JWT_SECRET is not configured
- Provides clear error message with instructions
- Ensures the application cannot start without proper JWT_SECRET

Impact: CRITICAL
Category: Security
Effort: 1 point (< 1 hour)

---
 server/src/middleware/auth.ts | 9 ++++++++-
 server/.env.example           | 4 ++++
 2 files changed, 12 insertions(+), 1 deletion(-)

diff --git a/server/src/middleware/auth.ts b/server/src/middleware/auth.ts
index a1b2c3d..e4f5g6h 100644
--- a/server/src/middleware/auth.ts
+++ b/server/src/middleware/auth.ts
@@ -3,7 +3,14 @@ import { Request, Response, NextFunction } from 'express';
 import jwt from 'jsonwebtoken';
 import { Request, Response, NextFunction } from 'express';

-const JWT_SECRET = process.env.JWT_SECRET || 'CHANGE-THIS-IN-PRODUCTION-USE-ENV-VAR';
+const JWT_SECRET = process.env.JWT_SECRET;
+
+if (!JWT_SECRET) {
+  console.error('âŒ FATAL: JWT_SECRET environment variable is not set!');
+  console.error('   Please add JWT_SECRET to your .env file with a secure random value.');
+  console.error('   Example: JWT_SECRET=$(openssl rand -base64 32)');
+  process.exit(1);
+}

 export interface AuthRequest extends Request {
   user?: {
diff --git a/server/.env.example b/server/.env.example
index h7i8j9k..l0m1n2o 100644
--- a/server/.env.example
+++ b/server/.env.example
@@ -20,3 +20,7 @@ COUCHDB_PASSWORD=password
 # Reminder Configuration
 REMINDER_SEND_HOUR=10
 REMINDER_SEND_MINUTE=0
+
+# JWT Secret (required for authentication)
+# Generate with: openssl rand -base64 32
+JWT_SECRET=your_jwt_secret_here
--
2.43.0
